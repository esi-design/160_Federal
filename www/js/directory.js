// Local data
var LocD ='[{"id":"75","side":"Left Side","company":"ALEXANDER, ARONSON, FINNING & CO","floor":"16","person":""},{"id":"76","side":"Left Side","company":"ALEXANDER, ARONSON, FINNING & CO","floor":"16","person":"Herbert S. Alexander"},{"id":"77","side":"Left Side","company":"ALEXANDER, ARONSON, FINNING & CO","floor":"16","person":"Joel Aronson"},{"id":"78","side":"Left Side","company":"ALEXANDER, ARONSON, FINNING & CO","floor":"16","person":"John T. Finning"},{"id":"79","side":"Left Side","company":"ALEXANDER, ARONSON, FINNING & CO","floor":"16","person":"John R. Buckley"},{"id":"80","side":"Left Side","company":"ALEXANDER, ARONSON, FINNING & CO","floor":"16","person":"Joy C. Child"},{"id":"81","side":"Left Side","company":"ALEXANDER, ARONSON, FINNING & CO","floor":"16","person":"Jeffrey V. Cicolini"},{"id":"82","side":"Left Side","company":"ALEXANDER, ARONSON, FINNING & CO","floor":"16","person":"Matthew R. Hutt"},{"id":"83","side":"Left Side","company":"ALEXANDER, ARONSON, FINNING & CO","floor":"16","person":"James G. Jumes"},{"id":"84","side":"Left Side","company":"ALEXANDER, ARONSON, FINNING & CO","floor":"16","person":"Sorie M. Kaba"},{"id":"85","side":"Left Side","company":"ALEXANDER, ARONSON, FINNING & CO","floor":"16","person":"David J. Kelleher"},{"id":"86","side":"Left Side","company":"ALEXANDER, ARONSON, FINNING & CO","floor":"16","person":"Robin D. Kelley"},{"id":"87","side":"Left Side","company":"ALEXANDER, ARONSON, FINNING & CO","floor":"16","person":"Dana J. Marks"},{"id":"88","side":"Left Side","company":"ALEXANDER, ARONSON, FINNING & CO","floor":"16","person":"Carla M. McCall"},{"id":"89","side":"Left Side","company":"ALEXANDER, ARONSON, FINNING & CO","floor":"16","person":"David P. McManus"},{"id":"90","side":"Left Side","company":"ALEXANDER, ARONSON, FINNING & CO","floor":"16","person":"Thomas A. Washburn"},{"id":"91","side":"Left Side","company":"ALEXANDER, ARONSON, FINNING & CO","floor":"16","person":"Richard L. Weiner"},{"id":"92","side":"Left Side","company":"AM TRUST E&S INSURANCE SERVICES","floor":"3","person":""},{"id":"93","side":"Left Side","company":"BARTON & GILMAN","floor":"10","person":""},{"id":"94","side":"Left Side","company":"BARTON & GILMAN","floor":"10","person":"Robert M. Elmer"},{"id":"95","side":"Left Side","company":"BARTON & GILMAN","floor":"10","person":"Greg Vanden-Eykel"},{"id":"96","side":"Left Side","company":"BARTON & GILMAN","floor":"10","person":"Pamela Slater Gilman"},{"id":"97","side":"Left Side","company":"BARTON & GILMAN","floor":"10","person":"Brendan T. Malvey"},{"id":"98","side":"Left Side","company":"BARTON & GILMAN","floor":"10","person":"Edward D. Shoulkin"},{"id":"99","side":"Left Side","company":"BOSTON BUSINESS JOURNAL\/MASS HIGH TECH","floor":"12","person":""},{"id":"100","side":"Left Side","company":"BOSTON PROJECTS","floor":"6","person":""},{"id":"101","side":"Left Side","company":"CITIZENS RESOURCES","floor":"18","person":""},{"id":"103","side":"Left Side","company":"CLOVER FAST FOOD","floor":"HIGH STREET","person":""},{"id":"104","side":"Left Side","company":"STANLEY M. COHEN","floor":"24","person":""},{"id":"105","side":"Left Side","company":"COLLIERS INTERNATIONAL","floor":"11","person":""},{"id":"106","side":"Left Side","company":"COLLIERS INTERNATIONAL","floor":"11","person":"Robert R. Brace"},{"id":"107","side":"Left Side","company":"COLLIERS INTERNATIONAL","floor":"11","person":"Dennis F. Callahan"},{"id":"108","side":"Left Side","company":"COLLIERS INTERNATIONAL","floor":"11","person":"David M. Douvadiian"},{"id":"109","side":"Left Side","company":"COLLIERS INTERNATIONAL","floor":"11","person":"James L. Elcock"},{"id":"110","side":"Left Side","company":"COLLIERS INTERNATIONAL","floor":"11","person":"Joseph P. Flaherty"},{"id":"111","side":"Left Side","company":"COLLIERS INTERNATIONAL","floor":"11","person":"Thomas J. Hynes, Jr."},{"id":"112","side":"Left Side","company":"COLLIERS INTERNATIONAL","floor":"11","person":"Robert P. LaPorte, Jr. "},{"id":"113","side":"Left Side","company":"COLLIERS INTERNATIONAL","floor":"11","person":"Ronald K. Perry"},{"id":"114","side":"Left Side","company":"COLLIERS INTERNATIONAL","floor":"11","person":"Kevin C. Phelan"},{"id":"115","side":"Left Side","company":"COLLIERS INTERNATIONAL","floor":"11","person":"Daniel R. Quinn"},{"id":"116","side":"Left Side","company":"CONGRESS DENTAL GROUP","floor":"FEDERAL STREET","person":"Robert Page, D.M.D"},{"id":"117","side":"Left Side","company":"EDELSTEIN & COMPANY","floor":"9","person":""},{"id":"118","side":"Left Side","company":"EDELSTEIN & COMPANY","floor":"9","person":"Michael P. Antonelli"},{"id":"119","side":"Left Side","company":"EDELSTEIN & COMPANY","floor":"9","person":"Marc D. Bello"},{"id":"120","side":"Left Side","company":"EDELSTEIN & COMPANY","floor":"9","person":"Barbara T. Damon"},{"id":"121","side":"Left Side","company":"EDELSTEIN & COMPANY","floor":"9","person":"Glenn A. Gates, JD"},{"id":"122","side":"Left Side","company":"EDELSTEIN & COMPANY","floor":"9","person":"Jonathan P. Gorski"},{"id":"123","side":"Left Side","company":"EDELSTEIN & COMPANY","floor":"9","person":"William F. Healey"},{"id":"124","side":"Left Side","company":"EDELSTEIN & COMPANY","floor":"9","person":"Denis C. Higgins"},{"id":"125","side":"Left Side","company":"EDELSTEIN & COMPANY","floor":"9","person":"Kerry A. Johnson"},{"id":"126","side":"Left Side","company":"EDELSTEIN & COMPANY","floor":"9","person":"Scott B. Kaplowitch"},{"id":"127","side":"Left Side","company":"EDELSTEIN & COMPANY","floor":"9","person":"William D. Mahoney"},{"id":"128","side":"Left Side","company":"EDELSTEIN & COMPANY","floor":"9","person":"Timothy J. O Connor"},{"id":"129","side":"Left Side","company":"EDELSTEIN & COMPANY","floor":"9","person":"Robert P. O Connor"},{"id":"130","side":"Left Side","company":"EDELSTEIN & COMPANY","floor":"9","person":"Alfonso A. Perillo"},{"id":"131","side":"Left Side","company":"EDELSTEIN & COMPANY","floor":"9","person":"Jason R. Pierce"},{"id":"132","side":"Left Side","company":"EDELSTEIN & COMPANY","floor":"9","person":"Christopher S. Swain"},{"id":"133","side":"Left Side","company":"EDELSTEIN WEALTH MANAGEMENT","floor":"9","person":""},{"id":"134","side":"Left Side","company":"FIRST REPUBLIC BANK","floor":"FEDERAL STREET","person":""},{"id":"135","side":"Left Side","company":"FIRST REPUBLIC BANK","floor":"7","person":""},{"id":"136","side":"Left Side","company":"FIRST REPUBLIC BANK","floor":"8","person":""},{"id":"137","side":"Left Side","company":"FORT HILL BARBER","floor":"LOBBY","person":"Lynn Provitola"},{"id":"138","side":"Left Side","company":"LEXIS NEXIS","floor":"22","person":""},{"id":"139","side":"Left Side","company":"MASSACHUSETTS EDUCATIONAL FINANCING AUTHORITY (MEFA)","floor":"4","person":""},{"id":"140","side":"Left Side","company":"MASSACHUSETTS HOUSING PARTNERSHIP","floor":"2","person":""},{"id":"141","side":"Left Side","company":"NEWS MART","floor":"ATRIUM","person":"Buddha Maharjan"},{"id":"142","side":"Left Side","company":"NISSENBAUM HICKEY","floor":"24","person":""},{"id":"143","side":"Left Side","company":"NISSENBAUM HICKEY","floor":"24","person":"Gerald L. Nissenbaum"},{"id":"144","side":"Left Side","company":"NISSENBAUM HICKEY","floor":"24","person":"Madeline M. Celletti"},{"id":"145","side":"Left Side","company":"NISSENBAUM HICKEY","floor":"24","person":"Wendy O. Hickey"},{"id":"146","side":"Left Side","company":"NOBLE FINANCIAL CAPITAL MARKETS","floor":"21","person":"Richard Giles"},{"id":"147","side":"Left Side","company":"QUABBIN CAPITAL","floor":"6","person":""},{"id":"148","side":"Left Side","company":"QUABBIN CAPITAL","floor":"6","person":"Steven A. Leese"},{"id":"149","side":"Left Side","company":"QUABBIN CAPITAL","floor":"6","person":"John I. Snow III"},{"id":"1","side":"Right Side","company":"TAURUS MANAGEMENT SERVICES","floor":"Lobby","person":""},{"id":"2","side":"Right Side","company":"RACKEMANN, SAWYER & BREWSTER","floor":"15","person":""},{"id":"3","side":"Right Side","company":"RACKEMANN, SAWYER & BREWSTER","floor":"15","person":"Jesse W. Abair"},{"id":"4","side":"Right Side","company":"RACKEMANN, SAWYER & BREWSTER","floor":"15","person":"Lauren D. Armstrong"},{"id":"5","side":"Right Side","company":"RACKEMANN, SAWYER & BREWSTER","floor":"15","person":"Daniel J. Bailey"},{"id":"6","side":"Right Side","company":"RACKEMANN, SAWYER & BREWSTER","floor":"15","person":"Francesco A. De Vito"},{"id":"7","side":"Right Side","company":"RACKEMANN, SAWYER & BREWSTER","floor":"15","person":"Albert M. Fortier, Jr."},{"id":"8","side":"Right Side","company":"RACKEMANN, SAWYER & BREWSTER","floor":"15","person":"Stuart T. Freeland"},{"id":"9","side":"Right Side","company":"RACKEMANN, SAWYER & BREWSTER","floor":"15","person":"Richard J. Gallogly"},{"id":"10","side":"Right Side","company":"RACKEMANN, SAWYER & BREWSTER","floor":"15","person":"Ellen M. Harrington"},{"id":"11","side":"Right Side","company":"RACKEMANN, SAWYER & BREWSTER","floor":"15","person":"Brian M. Hurley"},{"id":"12","side":"Right Side","company":"RACKEMANN, SAWYER & BREWSTER","floor":"15","person":"Kurt A. James"},{"id":"13","side":"Right Side","company":"RACKEMANN, SAWYER & BREWSTER","floor":"15","person":"Matthew J. Leonard"},{"id":"14","side":"Right Side","company":"RACKEMANN, SAWYER & BREWSTER","floor":"15","person":"J. David Leslie"},{"id":"15","side":"Right Side","company":"RACKEMANN, SAWYER & BREWSTER","floor":"15","person":"Sanford M. Matathia"},{"id":"16","side":"Right Side","company":"RACKEMANN, SAWYER & BREWSTER","floor":"15","person":"Louis C. Miller"},{"id":"17","side":"Right Side","company":"RACKEMANN, SAWYER & BREWSTER","floor":"15","person":"Maura E. Murphy"},{"id":"18","side":"Right Side","company":"RACKEMANN, SAWYER & BREWSTER","floor":"15","person":"Michael F. O Connell"},{"id":"19","side":"Right Side","company":"RACKEMANN, SAWYER & BREWSTER","floor":"15","person":"Nancy G. O Donnell"},{"id":"20","side":"Right Side","company":"RACKEMANN, SAWYER & BREWSTER","floor":"15","person":"Gareth I. Orsmond"},{"id":"21","side":"Right Side","company":"RACKEMANN, SAWYER & BREWSTER","floor":"15","person":"Daniel J. Ossoff"},{"id":"22","side":"Right Side","company":"RACKEMANN, SAWYER & BREWSTER","floor":"15","person":"Donald R. Pinto, Jr."},{"id":"23","side":"Right Side","company":"RACKEMANN, SAWYER & BREWSTER","floor":"15","person":"Alan B. Rubenstein."},{"id":"24","side":"Right Side","company":"RACKEMANN, SAWYER & BREWSTER","floor":"15","person":"Johanna Schneider"},{"id":"25","side":"Right Side","company":"RACKEMANN, SAWYER & BREWSTER","floor":"15","person":"Eric A. Smith"},{"id":"26","side":"Right Side","company":"RACKEMANN, SAWYER & BREWSTER","floor":"15","person":"Janet M. Smith"},{"id":"27","side":"Right Side","company":"RACKEMANN, SAWYER & BREWSTER","floor":"15","person":"Jeffrey J. Upton"},{"id":"28","side":"Right Side","company":"RACKEMANN, SAWYER & BREWSTER","floor":"15","person":"James A. Wachta"},{"id":"29","side":"Right Side","company":"RACKEMANN, SAWYER & BREWSTER","floor":"15","person":"Lucy W. West"},{"id":"30","side":"Right Side","company":"RACKEMANN, SAWYER & BREWSTER","floor":"15","person":"Laurence M. Yorra"},{"id":"31","side":"Right Side","company":"RACKEMANN STRATEGIC CONSULTING","floor":"15","person":"Steven C. Davis"},{"id":"32","side":"Right Side","company":"RAYMOND PERSONAL TAILOR ","floor":"FEDERAL STREET","person":"Raymond Buckley"},{"id":"33","side":"Right Side","company":"RISK STRATEGIES COMPANY BROKERAGE","floor":"2","person":""},{"id":"34","side":"Right Side","company":"RISK STRATEGIES COMPANY BROKERAGE","floor":"4","person":""},{"id":"35","side":"Right Side","company":"M. ROBINSON & COMPANY","floor":"6","person":"Deborah P. Robinson"},{"id":"36","side":"Right Side","company":"M. ROBINSON & COMPANY","floor":"6","person":"Morris N. Robinson, Esq."},{"id":"37","side":"Right Side","company":"M. ROBINSON & COMPANY","floor":"6","person":"Yale Yechiel N. Robinson, Esq."},{"id":"38","side":"Right Side","company":"M. ROBINSON & COMPANY","floor":"6","person":"Patricia Weisgerber, Esq."},{"id":"39","side":"Right Side","company":"ROCKPORT GROUP","floor":"18","person":""},{"id":"40","side":"Right Side","company":"ROCKPORT PARTNERS","floor":"18","person":"Alexander Ellis III"},{"id":"41","side":"Right Side","company":"ROCKPORT PARTNERS","floor":"18","person":"Janet James"},{"id":"42","side":"Right Side","company":"ROCKPORT PARTNERS","floor":"18","person":"William E. James"},{"id":"43","side":"Right Side","company":"ROCKPORT PARTNERS","floor":"18","person":"Charles J. McDermott"},{"id":"44","side":"Right Side","company":"ROCKPORT PARTNERS","floor":"18","person":"David Prend"},{"id":"45","side":"Right Side","company":"ROCKPORT PARTNERS","floor":"18","person":"Stoddard Wilson"},{"id":"46","side":"Right Side","company":"STONE PHOTO & COPY","floor":"FEDERAL STREET","person":""},{"id":"47","side":"Right Side","company":"TASHTEGO","floor":"17","person":""},{"id":"48","side":"Right Side","company":"TAYLOR, GANSON & PERRIN","floor":"29","person":"Timothy D. Braughler"},{"id":"49","side":"Right Side","company":"TAYLOR, GANSON & PERRIN","floor":"29","person":"Martha Carroll Casey"},{"id":"50","side":"Right Side","company":"TAYLOR, GANSON & PERRIN","floor":"29","person":"Bradley R. Cook"},{"id":"51","side":"Right Side","company":"TAYLOR, GANSON & PERRIN","floor":"29","person":"Paul F. Donovan"},{"id":"52","side":"Right Side","company":"TAYLOR, GANSON & PERRIN","floor":"29","person":"John P. Fulginiti"},{"id":"53","side":"Right Side","company":"TAYLOR, GANSON & PERRIN","floor":"29","person":"Peter M. Golemme"},{"id":"54","side":"Right Side","company":"TAYLOR, GANSON & PERRIN","floor":"29","person":"Marisa S. Gregg"},{"id":"55","side":"Right Side","company":"TAYLOR, GANSON & PERRIN","floor":"29","person":"Maureen B. Hampe"},{"id":"56","side":"Right Side","company":"TAYLOR, GANSON & PERRIN","floor":"29","person":"Joseph G. Imbriani"},{"id":"57","side":"Right Side","company":"TAYLOR, GANSON & PERRIN","floor":"29","person":"Edward R. Martin"},{"id":"58","side":"Right Side","company":"TAYLOR, GANSON & PERRIN","floor":"29","person":"John P. Fulginiti"},{"id":"59","side":"Right Side","company":"TAYLOR, GANSON & PERRIN","floor":"29","person":"Matthew E. Moore"},{"id":"60","side":"Right Side","company":"TAYLOR, GANSON & PERRIN","floor":"29","person":"Gregory J. Murphy"},{"id":"61","side":"Right Side","company":"TAYLOR, GANSON & PERRIN","floor":"29","person":"Charles F. O Connell"},{"id":"62","side":"Right Side","company":"TAYLOR, GANSON & PERRIN","floor":"29","person":"Brian P. Shea"},{"id":"63","side":"Right Side","company":"TAYLOR, GANSON & PERRIN","floor":"29","person":"Michael J. Starr"},{"id":"64","side":"Right Side","company":"GANSON & COMPANY","floor":"19","person":""},{"id":"65","side":"Right Side","company":"GANSON & COMPANY","floor":"19","person":"Charles M. Ganson, Jr."},{"id":"66","side":"Right Side","company":"GANSON & COMPANY","floor":"19","person":"Robert L. Wareham"},{"id":"67","side":"Right Side","company":"TETRA TEC","floor":"3","person":""},{"id":"68","side":"Right Side","company":"TIFFIN & TIFFIN","floor":"6","person":"James B. Tiffin"},{"id":"69","side":"Right Side","company":"TRIBE HAIR SALON","floor":"HIGH STREET","person":""},{"id":"70","side":"Right Side","company":"TURAN CORPORATION","floor":"21","person":""},{"id":"71","side":"Right Side","company":"SMITH, LEVENSON & SMITH","floor":"21","person":""},{"id":"72","side":"Right Side","company":"VISION CARE 2000","floor":"HIGH STREET","person":""},{"id":"73","side":"Right Side","company":"WILKINS INVESTMENT COUNSEL","floor":"17","person":""},{"id":"74","side":"Right Side","company":"TAYLOR, GANSON & PERRIN","floor":"29","person":""}]';

$(document).ready(function(){
/*
	console.log('test');
	$(window).trigger('hashchange');
    */
    render(window.location.hash);
    $.support.cors=true;
    $.mobile.allowCrossDomainPages=true;
    $('.keyboard').hide();

    var oReq = new XMLHttpRequest();
    var tokens =[];
    var next =[];
    var info_div;
    var values =[];
    var Ldata = [];


    var companyName;
    var companyLocation;

    //Input to change from keyboard-inputs
    var InputName;
    
    $('.delete').click(function(){
	    $('#data_Select, #data_Select_cmpn, #data_Select__ppl').filterable( "refresh" );
	    
    });
    

//================= Page 1 =================//

	// An event handler with calls the render function on every hashchange.
	// The render function will show the appropriate content of out page.
	$(window).on('hashchange', function(){
		console.log('hash change');
		window.scrollTo(0, 0);
		render(window.location.hash);
	});


	
	function render(url) {

		// Get the keyword from the url.
		var temp = url.split('/')[0];

		// Hide whatever page is currently shown.
		$('.container .page').removeClass('visible');


		var map = {

			// The Homepage.
			'': function() {
				renderHome();
			},

			// Single Products page.
			'#page2': function() {
				console.log("page 2");

				// Get the index of which product we want to show and call the appropriate function.
				var index = url.split('/')[0];

				renderPage2();
			},
			
			'#page3': function() {

				// Get the index of which product we want to show and call the appropriate function.
				var index = url.split('/')[0];

				renderPage3();
			},
			
			'#page4': function() {
             console.log('page 4');
				// Get the index of which product we want to show and call the appropriate function.
				var index = url.split('/')[0];
				renderPage4();
			}

		};

		// Execute the needed function depending on the url keyword (stored in temp).
		if(map[temp]){
			map[temp]();
		}
		// If the keyword isn't listed in the above - render the error page.
		else {
			renderErrorPage();
		}

	}
// ================== HOME PAGE =========================//
canvas();

function renderHome() {
$('.black-bg').fadeIn();
  //$(':input[type=text]').empty();
  var page = $('#page1');
  console.log("RENDER Home");
		// Show the page itself.
		// (the render function hides all pages so we need to show the one we want).
		page.addClass('visible');
		$('#page1').on('click', function(e){
			e.preventDefault();
			window.location.hash = '#page2';
		});
	}

function canvas(){
	console.log('canvas');
	var outputCanvas = document.getElementById('output'),
		output = outputCanvas.getContext('2d'),
		bufferCanvas = document.getElementById('buffer'),
		buffer = bufferCanvas.getContext('2d'),
		video = document.getElementById('video'),
		width = outputCanvas.width,
		height = outputCanvas.height,
		interval;
		
	function processFrame() {
		buffer.drawImage(video, 0, 0);

		var	image = buffer.getImageData(0, 0, width, height),
			imageData = image.data,
			alphaData = buffer.getImageData(0, height, width, height).data;
		
		for (var i = 3, len = imageData.length; i < len; i = i + 4) {
			imageData[i] = alphaData[i-1];
		}
		
		output.putImageData(image, 0, 0, 0, 0, width, height);
	}
	
	video.addEventListener('play', function() {
		clearInterval(interval);
		interval = setInterval(processFrame, 40)
	}, false);

	video.addEventListener('ended', function() {
		video.play();
	}, false);
	video.setAttribute("src", 'img/DesignDirectory_Interstitial_22_RGB+A-sm.mp4');
}


// ================== PAGE 2 =========================//
function renderPage2() {
  var page = $('#page2');
  console.log("RENDER Page 2");
  $('.black-bg').fadeOut();
  $('#submit').hide();
  $('#searchForCollapsibleSetChildren').empty();
		// Show the page itself.
		// (the render function hides all pages so we need to show the one we want).
		page.addClass('visible');
		
		$('#page2 input').click(function(){
         $('#write').empty();
         InputName = '#searchForCollapsibleSetChildren';

         // Set the Keyboard
         $('#data_Select, #data_Select_cmpny, #data_Select__ppl').animate({height : '200' }, function(){
	         $('.keyboard').fadeIn();
         });   
     });

/*
        $('#div_dir a').click(function(e){
	        console.log('click');
            var Comp_val = $('#searchForCollapsibleSetChildren').val();
            $('#visitor-company').val(Comp_val);
            e.preventDefault();
            window.location.hash = '#page3';
//             renderPage3(companyName,companyLocation);
        });
        
*/


    }

// ================== PAGE 3 =========================//
function renderPage3() {
 $('.keyboard').fadeOut();
 $('#name').empty();
 $('#visitor-company').empty();

		// Hide whatever page is currently shown.
		$('.container .page').removeClass('visible');
		var page = $('#page3');

		console.log("RENDER Page 3");
		// Show the page itself.
		// (the render function hides all pages so we need to show the one we want).
		page.addClass('visible');
		page.fadeIn();

/*
		$('#company').click(function(e){
			e.preventDefault();
			window.location.hash = '#page2';
		});
*/     


$('#page3 input').click(function(){
 $('#write').empty();
 console.log($(this).attr('id'));
 var inp =  $(this).attr('id');
 console.log(inp);

 if (inp == 'name'){
    InputName = '#name';
    console.log('Input : Name')
}
if(inp == 'visitor-company'){
    InputName = '#visitor-company';
    console.log('Input : visitor-company')
}

$('#submit').show();
$('#_cmpny, #_ppl, #_all').hide();
$('.keyboard').fadeIn();
});

$('#page3 .ui-select').click(function(){
	$('#write').empty();
	console.log($(this).attr('id'));
	var inp =  $(this).attr('id');
	console.log(inp);
	
	if (inp == 'name'){
	InputName = '#name';
	console.log('Input : Name')
	}
	if(inp == 'visitor-company'){
	InputName = '#visitor-company';
	console.log('Input : visitor-company')
	}
	
	$('#submit').show();
	$('#_cmpny, #_ppl, #_all').hide();
	$('.keyboard').fadeOut();
});
}

// ================== PAGE 4 =========================//

function renderPage4() {
    $('.keyboard').hide();
    var page = $('#page4');
    console.log("RENDER Page 4");
		// Show the page itself.
		// (the render function hides all pages so we need to show the one we want).
		page.addClass('visible');
		page.fadeIn();
		$('#page4').on('click', function(e){
			e.preventDefault();
			window.location.hash = '';
		});
	}
	
	// Shows the error page.
	function renderErrorPage(){
		var page = $('.error');
		page.addClass('visible');
	}

// $('select').select2({minimumResultsForSearch: Infinity});

//================= Page 2 =================//

        //Onload get directory data
        var urlReq ="http://esidesigndev.com/data_Demo/building.php"
        
        connectSql(urlReq);

         // To retrieve data --- Debug button 
         $("#_reqB").click(function () {
            console.log("Ready to Get data");
            var urlReq ="http://esidesigndev.com/data_Demo/building.php"
            connectSql(urlReq);
        });

        //Show the company names and locations in the html element page 2     
        //div page 2
        $('#data_Select').show();
        $('#data_Select_cmpny, #data_Select__ppl').hide();
        
        //Show ByCompany page 2
        $('#_cmpny').click(function(){
	        $('.active').removeClass('active');
	        $('#_cmpny').addClass('active');
            console.log("Show Company");
            $('#data_Select, #data_Select__ppl').hide();
            $('#data_Select_cmpny').show();
            getValues('#data_Select_cmpny');
        });
        //Show ByPeople page 2
        $('#_ppl').click(function(){
	        $('.active').removeClass('active');
	        $('#_ppl').addClass('active');
            console.log("Show people");
            $('#data_Select, #data_Select_cmpny').hide();
            $('#data_Select__ppl').show();
            getValues('#data_Select__ppl');
        });
        //Show default All page 2
        $('#_all').click(function(){
	        $('.active').removeClass('active');
	        $('#_all').addClass('active');
            console.log("Show All");
            $('#data_Select').show();
            $('#data_Select_cmpny, #data_Select__ppl').hide();
            getValues('#data_Select');
        });



//================= Page 3 =================//

        //  To send form to the data base

        $("#submit").click(function(e){
           var company = $("#company").val();
           var floor = $("#floor").val();
           var visitor = $("#name").val();
           var visitorCompany = $("#visitor-company").val();
           var purpose = $("#purpose").val();
           var urlSnd= "http://esidesigndev.com/data_Demo/guestform.php?company="+company+"&lid="+visitor+"&visitorCompany="+visitorCompany+"&purpose="+purpose;
           values = new Array();
           values.push(company);
           values.push(visitor);
           values.push(visitorCompany);
           values.push(purpose);

           connectSqlSed(urlSnd); 

           console.log(name + ","+ floor);

           $('#place').text(company);
           $('#flr').text(floor);
            e.preventDefault();
            window.location.hash = '#page4';
			
       }); 


 // ================= CONNECTION FUNCTIONS ================= //
 
 // call get data

 function connectSql(data){

    var url = data;

    if (oReq != null) {
        oReq.open("GET", url , true);
        oReq.onreadystatechange = handler;
        oReq.send();
    }
    else {

        window.console.log("NO INTERNET");
    }
}


// Get the data  -- xhml 

function handler()
{
    if (oReq.readyState == 4 /* complete */) {
        if (oReq.status >= 200 && (oReq.status < 300 || oReq.status === 304)) {
            var bval=oReq.responseText;
            console.log(oReq.status);
            convdata(bval);
        }
        else{
//             navigator.notification.alert("No Internet Connection");
console.log("error");
convdata(LocD);
}
}
}


 // Send Data

 function connectSqlSed(urldata){

    var url = urldata;

    if (oReq != null) {
        oReq.open("GET", url , true);
        oReq.onreadystatechange = sendData;
        oReq.send();
    }
    else {
        window.console.log("NO INTERNET");
    }
}

// Call to check for connection

function sendData()
{
   var localData = values;
   if (oReq.readyState == 4 /* complete */) {
    if (oReq.status >= 200 && (oReq.status < 300 || oReq.status === 304)) {
        console.log(oReq.status);
    }
    else{
        console.log("error");
        Ldata.push(localData);

    }
}
}

// Send Data

function recovData(){

  for (i in Ldata){

    var url= "http://esidesigndev.com/data_Demo/guestform.php?company="+Ldata[i][0]+"&lid="+Ldata[i][1]+"&visitorCompany="+Ldata[i][2]+"&purpose="+"RECOVER_ "+Ldata[i][3];

    if (oReq != null) {
        oReq.open("GET", url , true);
        oReq.onreadystatechange = reData;
        oReq.send();

    }
    else {
        window.console.log("NO INTERNET");
    }
    Ldata.shift(); 
    console.log(Ldata.length);
}
}

// Call to check for connection

function reData()
{
    if (oReq.readyState == 4 /* complete */) {
        if (oReq.status >= 200 && (oReq.status < 300 || oReq.status === 304)) {
            //console.log(oReq.status); 
            console.log(Ldata)
            if (Ldata.length < 1){
                console.log("SEND EMAIL HERE");
                //Send the email notifying the recover of data -- Internet off
            }    

        }
        else {
            console.log("No Internet Connection");
        }
    }
}


// function to convert data into JSON -- Windows doesn't support jQueryAJAX, JSON.parse() or jQuery.parseJSON()

function convdata(data){

    var dt_one = data;
    var key=[],toJson=[],obj=[];

                // Converting data into JSON object

                if (dt_one.length > 11 ){ 

                // Parsing data -- Generate new array "obj" and new JSON "tokens"

                var filter_one= dt_one.replace(/([\$\w]+)\s*:/g, function(_, $1){return '"'+$1+'":'});
                var filter_two = filter_one.replace(/'([^']+)'/g, function(_, $1){return '"'+$1+'"'});
                var tnt = filter_two.split(/[{()}]+/);

                for(i in tnt){
                    if( tnt[i].length > 2){
                        key.push(tnt[i]);
                    }
                }
                for(i in key){
                  var values = new Array();
                  var keyOne =key[i].split(/","+/); 
                  for (var j =0; j< keyOne.length; j++){
                    var mkey = keyOne[j].split(":");
                    var mkeytwo = mkey[1];
                    if(mkeytwo!=undefined){   
                        var res = mkeytwo.replace(/"/g, "");
                        if (res.length >= 1){

                            values.push(res);
                        }
                    }
                }
                toJson.push(values);
            }

            for(i in toJson){
                if(toJson[i]!= undefined){
                    obj.push(toJson[i])
                }
            }
            for (i in obj){
              var _company = String(obj[i][2]);
              var _location = String(obj[i][3]);
              var _people = String(obj[i][4]);
              tokens.push({'company': _company , 'location' : _location ,'people':_people});
          }
                                // To filter duplicates
                                for( var i =1;i< obj.length; i++){
                                 if(obj[i][2] != obj[i-1][2]){
                                    next.push(obj[i]);
                                }
                            }
                            getValues('#data_Select');      
                        }

                        else {
                //This is to send data
                console.log("Login Data");
            }
        };

        
// Additional to get data. This is handy for reset the data load


function getValues(data){
    var c_Data= data;
    var c_Name;

    for(i in next){

       var clase ='';
       if (i <= 1){
        clase = 'ui-collapsible ui-first-child'
    }
    if (i == next.length-1){
        clase = 'ui-collapsible ui-last-child'
    }
    else{
        clase = 'ui-collapsible'
    }

    var comp_title =$(document.createElement('h3')).attr({
     'class': "ui-collapsible-heading ui-collapsible-heading-collapsed",
 });
    var spam_a =$(document.createElement('a')).attr({
        'class': 'ui-collapsible-heading-toggle',
        'href': "#"
    }).text(String(next[i][2]));

    var spam_b =$(document.createElement('h4')).attr({
        'id': 'floor',
        'class': 'ui-collapsible-heading-toggle',
                 //href: "#"
             }).text(String(next[i][3]));

    var ul_data = $(document.createElement("ul")).attr({
        'data-role':"listview", 'data-inset':"true",
        'class':"ui-listview",
        'id': "_list",
        'value': next[i][2] + "_Floor_" + next[i][2],
    });
    var comp_name = $(document.createElement("div")).attr({ 
        'data-role':"collapsible",
        'data-collapsed':'false',
        value:next[i][2] ,
        'data-inset': 'false',
        'data-content-theme':"false",
        'class': clase,
    });
    var cont_ul = $(document.createElement('div')).attr({
        'class' :"ui-collapsible-content",
        'aria-hidden' :"false"
    });

    $(comp_name).removeClass("ui-screen-hidden")
    $(comp_title).append(spam_a);
    $(comp_title).append(spam_b);
    $(cont_ul).append(ul_data);
    $(comp_name).append(comp_title);
    $(comp_name).append(cont_ul);

    $(c_Data).append(comp_name);

    var rep = new Array();
    var toSearch = String(next[i][2]);
    rep.push(toSearch);




    if(c_Data!='#data_Select_cmpny'){

        for(i in tokens){
            if(tokens[i].company == toSearch){
                if(tokens[i].people!=="undefined"){
                    rep.push(String(tokens[i].people));
                    var clasz = ''
                    if (rep.length <= 2){
                        clasz ='ui-li-static ui-body-inherit ui-first-child'
                    }
                    else{
                        clasz ='ui-li-static ui-body-inherit'
                    }
                    var list = $(document.createElement('li')).attr({
                        'data-filtertext':tokens[i].people,
                        'class':clasz,
                    });
                    var list_link = $(document.createElement('a')).attr({
                        'data-filtertext':tokens[i].people,
                        'class':clasz,
                        'href': '#',
                    }).text(String(tokens[i].people)).val(tokens[i].company + "|" + tokens[i].location);


                    $(list_link).click(function(){

                        inputText = $(this).text();
                        var NLoc = ($(this).val()).split("|");

                        companyName = NLoc[0] + " | " + inputText;
                        companyLocation= NLoc[1];

                        console.log(companyName + " | "+ companyLocation);
                        $('#searchForCollapsibleSetChildren').val(companyName);
							
                    });
                    $(list).append(list_link);
                    $(ul_data).append(list);
                }
            }
        }
    }
    rep.toString();
    var fil_a = rep.toString();  
    var fil_b= fil_a.replace(/,/g," ");
    $(comp_name).attr({'data-filtertext' : fil_b })

    $(comp_title).click(function(){
       c_Name = $(this).find('a').text();
       c_Location = $(this).find('h4').text();

       companyName = c_Name;
       companyLocation= c_Location;
       console.log(companyName + " | "+ companyLocation);

       $('#searchForCollapsibleSetChildren').val(c_Name); 
       $('#company').val(c_Name); 
       $('#floor').val(c_Location); 
       window.location.hash = '#page3';    
   });
}
}



//===============KEYBOARD======================//

var $write = $('#write'),
symbol = false,
capslock = false;

$('.close-keyboard').click(function(){
	$('.keyboard').fadeOut(function(){
		$('#data_Select, #data_Select_cmpny, #data_Select__ppl').animate({height : '500' }); 
	});
}); 

$('#keyboard li').click(function(){
    var $this = $(this),
        character = $this.html(); // If it's a lowercase letter, nothing happens to this variable

        // Shift keys
        if ($this.hasClass('symbol-toggle')) {
            $('.letter span').toggle();

            symbol = (symbol === true) ? false : true;
            capslock = false;
            return false;
        }

        // Caps lock
        if ($this.hasClass('capslock')) {
            $('.letter').toggleClass('uppercase');
            capslock = true;
            return false;
        }

        // Delete
        if ($this.hasClass('delete')) {
			var html = $write.html();
			
			$write.html(html.substr(0, html.length - 1));
			$(InputName).val($write.val());
			$('#data_Select, #data_Select_cmpn, #data_Select__ppl').filterable( "refresh" );
          
            return false;
        }

        // Special characters
        if ($this.hasClass('letter')) character = $('span:visible', $this).html();
        if ($this.hasClass('space')) character = ' ';
        if ($this.hasClass('return')) character = "\n";

        // Uppercase letter
        if ($this.hasClass('uppercase')) character = character.toUpperCase();

        // Remove shift once a key is clicked.
        if (symbol === true) {
            $('.letter span').toggle();
            if (capslock === false) $('.letter').toggleClass('uppercase');

            symbol = false;
        }

        // Add the character
        console.log($write.html() + character);
        $write.html($write.html() + character);
        $(InputName).val($write.val());
        $('#data_Select, #data_Select_cmpn, #data_Select__ppl').filterable( "refresh" );
   });




setInterval(function(){
    var date = new Date();
    if(date.getHours() === 6 && date.getMinutes() === 00 && date.getSeconds() === 00){
       recovData();
   }
},1000);



});


// ================= TIMEOUT ================= //
// var timeout;
// $(document).on("mousemove keydown click touchstart", function() {
//     clearTimeout(timeout);
//     timeout = setTimeout(function() {
// 		console.log('timeout');
//          window.location = '';
//     }, 1000 * 60 * 3);
// }).click();